<!DOCTYPE html>
<html lang="en">
<head>
<!-- NES Checklist PWA v36.9 fonts+plink | built 2025-10-12T04:00:37.964561Z -->

<!-- NES v36.8: tighter app logo fill + refreshed PWA icons | 2025-10-12T03:59:21.482581Z -->

<!-- NES Checklist PWA v36.4 minimal-clean | built 2025-10-12T03:23:11.326206Z -->

<!-- NES Checklist PWA internal version: v31-clean-fix | built 2025-10-12T01:33:11.961977Z | based on v19.1 hotfix -->

<meta charset="utf-8" >
<meta name="viewport" content="width=device-width, initial-scale=1" >
<title>NES â€” Manager Notes Checklist (v17)</title>
<link rel="manifest" href="manifest.json">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32.png">
<meta name="theme-color" content="#003366" >
<style>

/* v36.9 + Appt's mini-module */
.appt2-action{
  margin-left:8px;font-size:12px;padding:4px 8px;border-radius:6px;
  border:1px solid var(--line,#c7c7c7);background:var(--panel,#f7f7f9);cursor:pointer;
}
.appt2-action:hover{ filter:brightness(.98); }

/* Modal */
#appt2Modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);
  z-index:1000;align-items:center;justify-content:center;}
.appt2-card{background:#fff;color:#111;max-width:760px;width:94vw;border-radius:12px;
  box-shadow:0 8px 30px rgba(0,0,0,.25);overflow:hidden;font-family:inherit;}
.appt2-head{display:flex;align-items:center;justify-content:space-between;
  padding:12px 16px;border-bottom:1px solid var(--line,#ddd);font-weight:700;}
.appt2-body{padding:14px 16px;display:flex;gap:14px;flex-wrap:wrap;}
.appt2-col{flex:1 1 260px;min-width:260px}
.appt2-list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:8px;}
.appt2-row{border:1px solid var(--line,#ddd);border-radius:8px;padding:8px}
.appt2-actions{display:flex;gap:8px;flex-wrap:wrap}
.appt2-input{padding:8px;border:1px solid var(--line,#ccc);border-radius:8px;width:100%}
.appt2-btn{appearance:none;border:1px solid var(--line,#c7c7c7);background:#f7f7f9;
  padding:6px 10px;border-radius:8px;cursor:pointer;font-weight:600}
.appt2-btn.primary{background:#0b4da2;color:#fff;border-color:#0b4da2}
.appt2-btn:hover{filter:brightness(.98)}

/* v36.8 logo tight fill */
header .brand-logo {
  padding: 0;              /* remove inner padding so the logo fills the frame */
  max-width: 360px;        /* allow it to be a bit larger */
  width: clamp(220px, 42vw, 360px);
  height: auto;
  object-fit: contain;     /* keep proportions, no cropping */
  box-shadow: 0 0 0 2px #fff, 0 3px 10px rgba(0,0,0,.08); /* slimmer white frame */
}

  :root { --font: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; --bg:#ffffff; --text:#222; --muted:#666; --line:#AAA; --danger:#b00020;
           --btn-primary-bg:#003366; --btn-primary-border:#003366; --btn-secondary-bg:#f5f5f5; --btn-secondary-border:#ddd; --btn-danger-bg:#ffe7ea; --btn-danger-border:#ffcbd2; }
  * { box-sizing:border-box; }
  html,body { margin:0; padding:0; background:var(--bg); color:var(--text); font-family: var(--font); }
  .container { max-width: 960px; margin: 28px auto 60px; padding: 0 24px; }
  header { display:flex; flex-direction:column; align-items:center; gap:10px; margin-bottom:10px; }
  header .brand-logo { max-width:320px; width:clamp(200px,40vw,320px); height:auto; object-fit:contain; background:#fff; padding:8px; border-radius:10px; box-shadow: 0 0 0 4px #fff, 0 3px 10px rgba(0,0,0,.08); }
  header h1 { font-size:24px; margin:0; font-weight:800; letter-spacing:.2px; }
  .topbar { display:flex; flex-wrap:wrap; gap:12px 16px; align-items:center; justify-content:space-between; margin:8px 0 18px; padding:10px 0; border-top:1px solid var(--line); border-bottom:1px solid var(--line); }
  .row { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
  label { font-weight:700; margin-right:6px; }
  input[type="date"], select { padding:6px 8px; border:1px solid var(--line); border-radius:4px; background:#fff; color: var(--text); }
  .btn { border-radius:6px; padding:10px 14px; font-weight:800; cursor:pointer; letter-spacing:.2px; border:1px solid transparent; }
  .btn-primary { background: var(--btn-primary-bg); color:#fff; border-color: var(--btn-primary-border); }
  .btn-secondary { background: var(--btn-secondary-bg); color:#333; border-color: var(--btn-secondary-border); }
  .btn-danger { background: var(--btn-danger-bg); color:#b00020; border-color: var(--btn-danger-border); }
  .btn:active { transform: translateY(1px); }
  .save-status { font-size:12px; color: var(--muted); padding:6px 10px; border:1px solid var(--line); border-radius:20px; }
  .section { margin-top:16px; }
  .section-title { font-size:16px; font-weight:800; color:#333; margin:18px 0 8px; }
  ul.checklist { list-style:none; padding:0; margin:0; border-top:1px solid var(--line); min-height:10px; }
  li.item { display:flex; align-items:center; gap:8px; padding:10px 0; border-bottom:1px solid var(--line); }
  li.item input[type="checkbox"] { width:16px; height:16px; flex:0 0 auto; }
  li.item .num { width:28px; text-align:right; color:var(--muted); font-weight:700; padding-right:4px; }
  li.item .label { flex:1 1 auto; outline:none; cursor:pointer; }
  li.item .del { flex:0 0 auto; background:#fff; border:1px solid var(--btn-danger-border); border-radius:6px; padding:4px 8px; font-weight:800; color:var(--danger); cursor:pointer; }
  li.item .del:hover { border-color:#e0a0a8; background:#fff5f6; }
  .placeholder { height:2px; background:var(--btn-primary-bg); margin:-1px 0; }
  @media print { .topbar, .del, #addRowBtn, #toggleLinksBtn, #usefulLinks { display:none !important; } .container { margin:0; max-width:none; } }

  #instrModal { position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.35); z-index:9999; }
  #instrModal .card { background:var(--bg); color:var(--text); max-width:720px; width:92%; border:1px solid var(--line); border-radius:10px; box-shadow:0 10px 30px rgba(0,0,0,.25); }
  #instrModal .card-head { display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid var(--line); }
  #instrModal .card-body { padding:16px; white-space:pre-wrap; line-height:1.5; }
</style>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Merriweather:wght@400;700&family=Nunito:wght@300;400;700&family=Open+Sans:wght@300;400;700&family=Pacifico&family=Poppins:wght@300;400;700&family=Quicksand:wght@300;400;700&family=Roboto+Slab:wght@400;700&display=swap" rel="stylesheet">


<style>
/* Monthly Appointment Tracker */
#apptTracker { background:#fff; border:1px solid var(--line,#e2e8f0); border-radius:12px; }
#apptTracker header { padding:12px 14px; border-bottom:1px solid var(--line,#e2e8f0); display:flex; align-items:center; justify-content:space-between; gap:12px; }
#apptTracker h2 { margin:0; font-size:18px; font-weight:800; }
#apptTracker .body { padding:14px; display:flex; gap:14px; flex-wrap:wrap; }
#apptTracker .col { flex:1 1 280px; min-width:280px; }
#apptTracker .subhead { font-weight:700; margin-bottom:6px; }
#apptTracker .list { list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:8px; }
#apptTracker .row { border:1px solid var(--line,#e2e8f0); border-radius:8px; padding:8px; background:#fafafa; }
#apptTracker .row .line { display:flex; align-items:center; justify-content:space-between; gap:8px; }
#apptTracker .btn { appearance:none; border:1px solid var(--line,#d0d7de); background:#f7f7f9; padding:6px 10px; border-radius:8px; cursor:pointer; font-weight:600; }
#apptTracker .btn.primary { background:#0b4da2; color:#fff; border-color:#0b4da2; }
#apptTracker .btn:hover { filter:brightness(.98); }
#apptTracker .inputs { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
#apptTracker input[type="date"], 
#apptTracker input[type="time"], 
#apptTracker input[type="text"] { padding:8px; border:1px solid var(--line,#d0d7de); border-radius:8px; background:#fff; }
</style>

<style id="mgrdocs-css">
#mgrDocsModal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.4);z-index:9999}
#mgrDocsModal .dlg{width:min(880px,92vw);max-height:86vh;overflow:auto;background:#fff;border:1px solid #e5e7eb;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.2)}
#mgrDocsModal header{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:14px 16px;border-bottom:1px solid #e5e7eb}
#mgrDocsModal h3{margin:0;font-size:18px;font-weight:800}
#mgrDocsModal .body{padding:12px 16px;display:grid;gap:10px}
.mgr-row{display:flex;align-items:center;justify-content:space-between;gap:10px;border:1px solid #e5e7eb;background:#f8fafc;border-radius:10px;padding:10px 12px}
.mgr-left{display:flex;align-items:center;gap:10px;min-width:0}
.mgr-title{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:52vw}
.mgr-actions{display:flex;gap:8px}
.mgr-btn{appearance:none;border:1px solid #cbd5e1;background:#fff;padding:6px 10px;border-radius:8px;font-weight:600;cursor:pointer}
.mgr-btn.primary{background:#0b4da2;border-color:#0b4da2;color:#fff}
.mgr-add{display:flex;gap:8px;flex-wrap:wrap;align-items:center;border:1px dashed #cbd5e1;background:#fff;padding:10px;border-radius:10px}
.mgr-add input[type="text"], .mgr-add input[type="file"]{padding:8px;border:1px solid #cbd5e1;border-radius:8px}
@media (prefers-color-scheme:dark){
  #mgrDocsModal .dlg{background:#0b1220;border-color:#1f2937}
  #mgrDocsModal header{border-color:#1f2937}
  .mgr-row{background:#0f172a;border-color:#1f2937}
  .mgr-btn{background:#0b1220;border-color:#334155;color:#e5e7eb}
}
</style>

<style id="day-service-events-css">
#dayServiceEvents { background:#fff; border:1px solid var(--line,#e2e8f0); border-radius:12px; }
#dayServiceEvents header { padding:12px 14px; border-bottom:1px solid var(--line,#e2e8f0); display:flex; align-items:center; justify-content:space-between; gap:12px; }
#dayServiceEvents h2 { margin:0; font-size:18px; font-weight:800; }
#dayServiceEvents .body { padding:14px; display:flex; gap:14px; flex-wrap:wrap; }
#dayServiceEvents .col { flex:1 1 320px; min-width:320px; }
#dayServiceEvents .subhead { font-weight:700; margin-bottom:6px; }
#dayServiceEvents .list { list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:8px; }
#dayServiceEvents .row { border:1px solid var(--line,#e2e8f0); border-radius:8px; padding:8px; background:#fafafa; display:flex; align-items:center; justify-content:space-between; gap:8px; }
#dayServiceEvents .line { display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
#dayServiceEvents .btn { appearance:none; border:1px solid var(--line,#d0d7de); background:#f7f7f9; padding:6px 10px; border-radius:8px; cursor:pointer; font-weight:600; }
#dayServiceEvents .btn.primary { background:#0b4da2; color:#fff; border-color:#0b4da2; }
#dayServiceEvents .inputs { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
#dayServiceEvents input[type="date"], 
#dayServiceEvents input[type="time"], 
#dayServiceEvents input[type="text"] { padding:8px; border:1px solid var(--line,#d0d7de); border-radius:8px; background:#fff; }
</style>

</head>
<body>
  <div class="container">
    <header>
      <img src="1000007845.jpg" alt="NES Logo" class="brand-logo" >
      <h1>Manager Notes Checklist</h1>
    </header>

    <div class="topbar">
      <div class="row">
        <label for="checklistDate">Date:</label>
        <input type="date" id="checklistDate" value="2025-10-11" >
        <label for="sheetSelect">Sheet:</label>
        <select id="sheetSelect" title="Choose a sheet"></select>
        <button class="btn btn-secondary" id="newSheetBtn">New</button>
        <button class="btn btn-secondary" id="renameSheetBtn">Rename</button>
        <button class="btn btn-danger" id="deleteSheetBtn">Delete</button>
      </div>
      <div class="row">
        <span id="saveStatus" class="save-status">Auto-save ready</span>
        <label for="presetSelect">Theme Preset:</label>
        <select id="presetSelect" title="Choose a preset theme"></select>
        <label for="fontSelect">Font:</label>
        <select id="fontSelect" title="Choose a font"></select>
        <button class="btn btn-primary" id="printBtn">Print / Save as PDF</button>
      </div>
    </div>

    <div class="section" id="section-1st"><div class="section-title">1st of Month</div><ul class="checklist" id="list-1st"></ul></div>
    <div class="section" id="section-before5th"><div class="section-title">Before the 5th</div><ul class="checklist" id="list-before5th"></ul></div>
    <div class="section" id="section-monthly"><div class="section-title">Monthly</div><ul class="checklist" id="list-monthly"></ul></div>
    <div class="section" id="section-biweekly"><div class="section-title">Bi-Weekly</div><ul class="checklist" id="list-biweekly"></ul></div>
    <div class="section" id="section-daily"><div class="section-title">Daily</div><ul class="checklist" id="list-daily"></ul></div>

    <div class="section" id="section-custom">
      <div class="section-title">Custom Items (Movable between sections)</div>
      <ul class="checklist" id="list-custom"></ul>
      <div style="display:flex;justify-content:center;margin-top:10px;">
        <button class="btn btn-primary" id="addRowBtn">+ Add Row</button>
      </div>
    </div>
  </div>

  <!-- Instructions Modal -->
  <div id="instrModal">
    <div class="card">
      <div class="card-head">
        <div id="instrTitle" style="font-weight:800;font-size:16px;">Task Instructions</div>
        <div style="display:flex;gap:8px;align-items:center;">
          <button id="editInstrBtn" class="btn btn-secondary" title="Add or edit instructions">Add / Edit</button>
          <button id="closeInstrBtn" class="btn btn-danger" title="Close">Close</button>
        </div>
      </div>
      <div class="card-body" id="instrBody"></div>
    </div>
  </div>


  <!-- Useful Links Toggle & Section -->
  <div style="margin: 24px;">
    <button id="toggleLinksBtn" class="btn btn-secondary" style="margin-bottom:10px;">
      Show Useful Links
    </button>

    <section id="usefulLinks" style="display:none; border-top: 2px solid var(--line); padding-top: 16px;">
      <h2 style="font-size:1.2rem; font-weight:700; margin:0 0 12px;">Useful Links</h2>
      <div style="display:flex; flex-wrap:wrap; gap:12px;">

        <!-- Primary actions -->
        <a href="https://secure.therapservices.net/ma/isp/ispDataSearch?backLink=%2Fnewfpage%2FswitchFirstPage&backType=1" target="_blank" rel="noopener noreferrer" class="btn btn-primary" style="text-decoration:none; padding:10px 18px; border-radius:8px;">ISP Search</a>
        <a href="https://secure.therapservices.net/ma/mar/marDataSearch?backLink=%2Fnewfpage%2FswitchFirstPage&backType=1" target="_blank" rel="noopener noreferrer" class="btn btn-primary" style="text-decoration:none; padding:10px 18px; border-radius:8px;">MAR Search</a>
        <a href="https://secure.therapservices.net/ma/tlog/programList?backLink=%2Fnewfpage%2FswitchFirstPage&backType=1" target="_blank" rel="noopener noreferrer" class="btn btn-primary" style="text-decoration:none; padding:10px 18px; border-radius:8px;">New Tlog</a>
        <a href="https://secure.therapservices.net/ma/ger/programList?backLink=%2Fnewfpage%2FswitchFirstPage&backType=1" target="_blank" rel="noopener noreferrer" class="btn btn-primary" style="text-decoration:none; padding:10px 18px; border-radius:8px;">GER</a>
        <a href="https://secure.therapservices.net/ma/hlth/appointments/individualList" target="_blank" rel="noopener noreferrer" class="btn btn-primary" style="text-decoration:none; padding:10px 18px; border-radius:8px;">New Appt</a>
        <a href="https://secure.therapservices.net/ma/hlth/appSearch" target="_blank" rel="noopener noreferrer" class="btn btn-primary" style="text-decoration:none; padding:10px 18px; border-radius:8px;">Search Appt</a>
        <a href="https://secure.therapservices.net/ma/hlth/appointment/calendar?backLink=%2Fnewfpage%2FswitchFirstPage&backType=1" target="_blank" rel="noopener noreferrer" class="btn btn-primary" style="text-decoration:none; padding:10px 18px; border-radius:8px;">Appt Calendar</a>

        <!-- Secondary tools -->
        <a href="https://webtime2.paylocity.com/webtime/v3/schedule" target="_blank" rel="noopener noreferrer" class="btn btn-secondary" style="text-decoration:none; padding:10px 18px; border-radius:8px;">House Schedule</a>
        
        
        
        
        <a href="https://calendar.google.com/" target="_blank" rel="noopener noreferrer" class="btn btn-secondary" style="text-decoration:none; padding:10px 18px; border-radius:8px;">Staff Calendar</a>
        

      </div>
    </section>
  </div>

<script>
document.addEventListener('DOMContentLoaded', function(){
  const SHEETS_KEY='nes_manager_checklist_sheets_v1';
  const STORAGE_PREFIX='nes_manager_checklist_sheet_';
  const THEME_PREFIX='nes_manager_checklist_theme_';
  const THEME_PRESET_PREFIX='nes_manager_checklist_theme_preset_';
  const FONT_KEY_PREFIX='nes_manager_checklist_font_';
  const INSTR_PREFIX='nes_manager_checklist_instructions_';
  const SMS_PREFIX='nes_manager_checklist_sms_';
  const LINKS_VIS_PREFIX='nes_manager_checklist_links_visible_';
  const DEFAULT_SHEET='Default';
  const lists=['list-1st','list-before5th','list-monthly','list-biweekly','list-daily','list-custom'];
  const keyFor=(p,n)=>p+n;

  // Theme & font (simple, stable)
  function defaultTheme(){ return {font:'system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif',bg:'#ffffff',text:'#222',line:'#AAA',btnPrimaryBg:'#003366',btnPrimaryBorder:'#003366',btnSecondaryBg:'#f5f5f5',btnSecondaryBorder:'#ddd',btnDangerBg:'#ffe7ea',btnDangerBorder:'#ffcbd2'}; }
  function applyTheme(t){
    const r=document.documentElement;
    if(t.font) r.style.setProperty('--font',t.font);
    r.style.setProperty('--bg',t.bg); r.style.setProperty('--text',t.text); r.style.setProperty('--line',t.line);
    r.style.setProperty('--btn-primary-bg',t.btnPrimaryBg); r.style.setProperty('--btn-primary-border',t.btnPrimaryBorder);
    r.style.setProperty('--btn-secondary-bg',t.btnSecondaryBg); r.style.setProperty('--btn-secondary-border',t.btnSecondaryBorder);
    r.style.setProperty('--btn-danger-bg',t.btnDangerBg); r.style.setProperty('--btn-danger-border',t.btnDangerBorder);
  }
  function saveTheme(t){ try{ localStorage.setItem(keyFor(THEME_PREFIX,currentSheet()), JSON.stringify(t)); }catch(e){} applyTheme(t); }
  function loadTheme(){
    let t=defaultTheme(); try{ const raw=localStorage.getItem(keyFor(THEME_PREFIX,currentSheet())); if(raw) t=Object.assign(t, JSON.parse(raw)); }catch(e){}
    applyTheme(t);
  }

  const presetSelect=document.getElementById('presetSelect');
  const fontSelect=document.getElementById('fontSelect');
  function loadPresetOptions(){
    const opts=[
  // ---- Business (6) ----
  { id:'biz-min', name:'Business â€” Minimal', t:{bg:'#ffffff',text:'#334155',line:'#cbd5e1',btnPrimaryBg:'#334155',btnPrimaryBorder:'#334155',btnSecondaryBg:'#f8fafc',btnSecondaryBorder:'#e2e8f0',btnDangerBg:'#fee2e2',btnDangerBorder:'#fecaca'} },
  { id:'biz-navy', name:'Business â€” Navy', t:{bg:'#ffffff',text:'#1f2937',line:'#e5e7eb',btnPrimaryBg:'#0b3d91',btnPrimaryBorder:'#0b3d91',btnSecondaryBg:'#f3f4f6',btnSecondaryBorder:'#e5e7eb',btnDangerBg:'#fee2e2',btnDangerBorder:'#fecaca'} },
  { id:'biz-exec', name:'Business â€” Executive', t:{bg:'#ffffff',text:'#111827',line:'#e5e7eb',btnPrimaryBg:'#0f766e',btnPrimaryBorder:'#0f766e',btnSecondaryBg:'#f9fafb',btnSecondaryBorder:'#e5e7eb',btnDangerBg:'#ffe4e6',btnDangerBorder:'#fecdd3'} },
  { id:'biz-slate', name:'Business â€” Slate', t:{bg:'#f8fafc',text:'#0f172a',line:'#e2e8f0',btnPrimaryBg:'#0f172a',btnPrimaryBorder:'#0f172a',btnSecondaryBg:'#f1f5f9',btnSecondaryBorder:'#e2e8f0',btnDangerBg:'#fee2e2',btnDangerBorder:'#fecaca'} },
  { id:'biz-emerald', name:'Business â€” Emerald', t:{bg:'#ffffff',text:'#0f172a',line:'#e5e7eb',btnPrimaryBg:'#065f46',btnPrimaryBorder:'#065f46',btnSecondaryBg:'#ecfdf5',btnSecondaryBorder:'#d1fae5',btnDangerBg:'#fee2e2',btnDangerBorder:'#fecaca'} },
  { id:'biz-maroon', name:'Business â€” Maroon', t:{bg:'#ffffff',text:'#1f2937',line:'#e5e7eb',btnPrimaryBg:'#7f1d1d',btnPrimaryBorder:'#7f1d1d',btnSecondaryBg:'#faf5f5',btnSecondaryBorder:'#fde2e2',btnDangerBg:'#fee2e2',btnDangerBorder:'#fecaca'} },

  // ---- Cute (6) ----
  { id:'cute-blossom', name:'Cute â€” Blossom', t:{bg:'#fff7fb',text:'#5b2245',line:'#f3cfe1',btnPrimaryBg:'#ec4899',btnPrimaryBorder:'#ec4899',btnSecondaryBg:'#fde5f1',btnSecondaryBorder:'#f3cfe1',btnDangerBg:'#ffe4e6',btnDangerBorder:'#fecdd3'} },
  { id:'cute-lavender', name:'Cute â€” Lavender', t:{bg:'#faf5ff',text:'#4c1d95',line:'#e9d5ff',btnPrimaryBg:'#7c3aed',btnPrimaryBorder:'#7c3aed',btnSecondaryBg:'#f3e8ff',btnSecondaryBorder:'#e9d5ff',btnDangerBg:'#fff1f2',btnDangerBorder:'#ffe4e6'} },
  { id:'cute-mint', name:'Cute â€” Mint', t:{bg:'#f0fff4',text:'#065f46',line:'#a7f3d0',btnPrimaryBg:'#10b981',btnPrimaryBorder:'#10b981',btnSecondaryBg:'#d1fae5',btnSecondaryBorder:'#a7f3d0',btnDangerBg:'#fff1f2',btnDangerBorder:'#ffe4e6'} },
  { id:'cute-sky', name:'Cute â€” Sky', t:{bg:'#eff6ff',text:'#1e40af',line:'#bfdbfe',btnPrimaryBg:'#3b82f6',btnPrimaryBorder:'#3b82f6',btnSecondaryBg:'#dbeafe',btnSecondaryBorder:'#bfdbfe',btnDangerBg:'#ffe4e6',btnDangerBorder:'#fecdd3'} },
  { id:'cute-peach', name:'Cute â€” Peach', t:{bg:'#fff7ed',text:'#7c2d12',line:'#fed7aa',btnPrimaryBg:'#f97316',btnPrimaryBorder:'#f97316',btnSecondaryBg:'#ffedd5',btnSecondaryBorder:'#fed7aa',btnDangerBg:'#ffe4e6',btnDangerBorder:'#fecdd3'} },
  { id:'cute-lemon', name:'Cute â€” Lemon', t:{bg:'#fefce8',text:'#713f12',line:'#fde68a',btnPrimaryBg:'#eab308',btnPrimaryBorder:'#eab308',btnSecondaryBg:'#fef9c3',btnSecondaryBorder:'#fde68a',btnDangerBg:'#fff1f2',btnDangerBorder:'#ffe4e6'} },

  // ---- Color (6) ----
  { id:'color-ocean', name:'Color â€” Ocean', t:{bg:'#f0f9ff',text:'#0c4a6e',line:'#bae6fd',btnPrimaryBg:'#0369a1',btnPrimaryBorder:'#0369a1',btnSecondaryBg:'#e0f2fe',btnSecondaryBorder:'#bae6fd',btnDangerBg:'#fee2e2',btnDangerBorder:'#fecaca'} },
  { id:'color-forest', name:'Color â€” Forest', t:{bg:'#f7fee7',text:'#14532d',line:'#d9f99d',btnPrimaryBg:'#15803d',btnPrimaryBorder:'#15803d',btnSecondaryBg:'#ecfccb',btnSecondaryBorder:'#d9f99d',btnDangerBg:'#fee2e2',btnDangerBorder:'#fecaca'} },
  { id:'color-sunset', name:'Color â€” Sunset', t:{bg:'#fff7ed',text:'#7c2d12',line:'#fed7aa',btnPrimaryBg:'#ea580c',btnPrimaryBorder:'#ea580c',btnSecondaryBg:'#ffedd5',btnSecondaryBorder:'#fed7aa',btnDangerBg:'#fee2e2',btnDangerBorder:'#fecaca'} },
  { id:'color-rose', name:'Color â€” Rose', t:{bg:'#fff1f2',text:'#881337',line:'#fecdd3',btnPrimaryBg:'#e11d48',btnPrimaryBorder:'#e11d48',btnSecondaryBg:'#ffe4e6',btnSecondaryBorder:'#fecdd3',btnDangerBg:'#fee2e2',btnDangerBorder:'#fecaca'} },
  { id:'color-plum', name:'Color â€” Plum', t:{bg:'#faf5ff',text:'#3b0764',line:'#e9d5ff',btnPrimaryBg:'#6d28d9',btnPrimaryBorder:'#6d28d9',btnSecondaryBg:'#f3e8ff',btnSecondaryBorder:'#e9d5ff',btnDangerBg:'#fee2e2',btnDangerBorder:'#fecaca'} },
  { id:'color-slate', name:'Color â€” Slate', t:{bg:'#f8fafc',text:'#0f172a',line:'#e2e8f0',btnPrimaryBg:'#0f172a',btnPrimaryBorder:'#0f172a',btnSecondaryBg:'#f1f5f9',btnSecondaryBorder:'#e2e8f0',btnDangerBg:'#fee2e2',btnDangerBorder:'#fecaca'} }
];
    presetSelect.innerHTML=''; opts.forEach(p=>{ const o=document.createElement('option'); o.value=p.id; o.textContent=p.name; presetSelect.appendChild(o); });
    presetSelect.addEventListener('change',()=>{ const f=opts.find(x=>x.id===presetSelect.value); if(f && f.t){ saveTheme(Object.assign(defaultTheme(), f.t)); } });
  }
  function loadFontOptions(){
    const fonts=[
      {id:'system', name:'System Sans', css:'system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif'},
      {id:'inter', name:'Inter', css:'Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif'},
      {id:'georgia', name:'Georgia', css:'Georgia, Cambria, serif'}
    ];
    fontSelect.innerHTML='';
    fonts.forEach(f=>{ const o=document.createElement('option'); o.value=f.id; o.textContent=f.name; fontSelect.appendChild(o); });
    function applyFont(id){ const f=fonts.find(x=>x.id===id)||fonts[0]; document.documentElement.style.setProperty('--font', f.css); }
    const fontKey=keyFor(FONT_KEY_PREFIX,currentSheet());
    try{ const saved=localStorage.getItem(fontKey); if(saved) applyFont(saved);}catch(e){}
    fontSelect.addEventListener('change', ()=>{ applyFont(fontSelect.value); try{ localStorage.setItem(fontKey, fontSelect.value); }catch(e){} });
  }

  // Sheets
  const sheetSelect=document.getElementById('sheetSelect');
  function getSheets(){ try{const t=localStorage.getItem(SHEETS_KEY); return t?JSON.parse(t):[DEFAULT_SHEET];}catch(e){return [DEFAULT_SHEET];} }
  function saveSheets(a){ try{localStorage.setItem(SHEETS_KEY,JSON.stringify(a));}catch(e){} }
  function currentSheet(){ return sheetSelect.value||DEFAULT_SHEET; }
  function refreshSheets(){ const names=getSheets(); sheetSelect.innerHTML=''; names.forEach(n=>{ const o=document.createElement('option'); o.value=n; o.textContent=n; sheetSelect.appendChild(o); }); }
  function ensureDefault(){ const names=getSheets(); if(!names.includes(DEFAULT_SHEET)){ names.unshift(DEFAULT_SHEET); saveSheets(names);}}

  // State
  function stateKey(){ return keyFor(STORAGE_PREFIX,currentSheet()); }
  function collectState(){
    const sections={};
    ['list-1st','list-before5th','list-monthly','list-biweekly','list-daily','list-custom'].forEach(id=>{
      const ul=document.getElementById(id);
      sections[id]=Array.from(ul.querySelectorAll('li.item')).map(li=>({label:(li.querySelector('.label')?.textContent)||'', checked:(li.querySelector('input[type="checkbox"]').checked)||false}));
    });
    return { date: document.getElementById('checklistDate').value, sections };
  }
  function applyState(s){
    if(!s) return;
    if(s.date) document.getElementById('checklistDate').value=s.date;
    ['list-1st','list-before5th','list-monthly','list-biweekly','list-daily','list-custom'].forEach(id=>{
      const ul=document.getElementById(id); ul.innerHTML='';
      (s.sections?.[id]||[]).forEach(it=>{ const li=mkItem(it.label, id==='list-custom'); li.querySelector('input[type="checkbox"]').checked=!!it.checked; ul.appendChild(li); });
    });
    renumberCustom(); ensureTimesheetSmsButton();
  }
  function saveState(){ try{ localStorage.setItem(stateKey(), JSON.stringify(collectState())); setStatus('Saved'); }catch(e){ setStatus('Save error'); } }
  function loadState(){ try{ const raw=localStorage.getItem(stateKey()); if(raw) applyState(JSON.parse(raw)); else initDefaults(); }catch(e){ initDefaults(); } }
  function setStatus(msg){ document.getElementById('saveStatus').textContent = msg + ' â€¢ ' + new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'}); }

  function mkItem(label, withNumber){
    const li=document.createElement('li'); li.className='item'; li.setAttribute('draggable','true');
    li.innerHTML = withNumber ? '<input type="checkbox"><div class="num"></div><div class="label" contenteditable="true"></div><button class="del" title="Remove">Ã—</button>'
                              : '<input type="checkbox"><div class="label"></div><button class="del" title="Remove">Ã—</button>';
    li.querySelector('.label').textContent = label || '';
    return li;
  }
  function initDefaults(){
    const defaults={
      'list-1st':[ 'Client Medical Assessment Form','RHS Absentee Form','House Sign-in Sheet','Fire Drill / Natural Disaster Drill','PRN Start Count' ],
      'list-before5th':[ 'Monthly summaries and monthly appointment','Emails to Support Coordinator' ],
      'list-monthly':[ 'House Meeting Notes (Due in Ben office after meeting)','Manager Meeting','Financials' ],
      'list-biweekly':[ 'Timesheets / Absentee Sheet','Check in Times for Accuracy' ],
      'list-daily':[ 'Check MARs and notes of your staff' ],
      'list-custom':[ 'Custom item 1','Custom item 2','Custom item 3' ]
    };
    ['list-1st','list-before5th','list-monthly','list-biweekly','list-daily','list-custom'].forEach(id=>{
      const ul=document.getElementById(id); ul.innerHTML='';
      defaults[id].forEach(lbl=>{ ul.appendChild(mkItem(lbl, id==='list-custom')); });
    });
    renumberCustom(); saveState();
  }

  // Drag & drop
  let dragEl=null; let placeholder=document.createElement('div'); placeholder.className='placeholder';
  function getAfter(ul, y){
    const els=[...ul.querySelectorAll('li.item:not(.dragging)')];
    return els.reduce((closest,child)=>{
      const box=child.getBoundingClientRect(); const offset=y-box.top-box.height/2;
      return (offset<0 && offset>closest.offset)? {offset,element:child} : closest;
    }, {offset:-Infinity, element:null}).element;
  }
  document.addEventListener('dragstart', e=>{ const li=e.target.closest('li.item'); if(!li) return; dragEl=li; li.classList.add('dragging'); });
  document.addEventListener('dragend', e=>{ if(!dragEl) return; dragEl.classList.remove('dragging'); dragEl=null; placeholder.remove(); renumberCustom(); saveState(); });
  document.querySelectorAll('ul.checklist').forEach(ul=>{
    ul.addEventListener('dragover', e=>{ e.preventDefault(); const after=getAfter(ul, e.clientY); if(!after) ul.appendChild(placeholder); else ul.insertBefore(placeholder, after); });
    ul.addEventListener('drop', e=>{ e.preventDefault(); if(!dragEl) return; ul.insertBefore(dragEl, placeholder); placeholder.remove(); });
  });
  function renumberCustom(){ const rows=document.querySelectorAll('#list-custom li.item'); let i=1; rows.forEach(li=>{ let n=li.querySelector('.num'); if(!n){ n=document.createElement('div'); n.className='num'; li.insertBefore(n, li.querySelector('.label')); } n.textContent=(i++)+'.'; }); }

  // Delete & add
  document.addEventListener('click', e=>{ const del=e.target.closest('.del'); if(del){ const li=del.closest('li.item'); li.remove(); renumberCustom(); saveState(); } });
  document.getElementById('addRowBtn').addEventListener('click', ()=>{ const ul=document.getElementById('list-custom'); ul.appendChild(mkItem('New custom item', true)); renumberCustom(); saveState(); });
  document.getElementById('printBtn').addEventListener('click', ()=>window.print());

  // Sheets UI
  function refreshSheets(){ const names=getSheets(); sheetSelect.innerHTML=''; names.forEach(n=>{ const o=document.createElement('option'); o.value=n; o.textContent=n; sheetSelect.appendChild(o); }); }
  function ensureDefault(){ const names=getSheets(); if(!names.includes(DEFAULT_SHEET)){ names.unshift(DEFAULT_SHEET); saveSheets(names);}}
  ensureDefault(); refreshSheets(); sheetSelect.value=getSheets()[0]||DEFAULT_SHEET;
  sheetSelect.addEventListener('change', ()=>{ loadState(); loadTheme(); loadLinksVisible(); });

  document.getElementById('newSheetBtn').addEventListener('click', ()=>{ const name=(prompt('Sheet name:', 'New Sheet')||'').trim(); if(!name) return; const names=getSheets(); if(names.includes(name)) return alert('Name exists'); names.push(name); saveSheets(names); refreshSheets(); sheetSelect.value=name; initDefaults(); loadLinksVisible(); });
  document.getElementById('renameSheetBtn').addEventListener('click', ()=>{
    const old=sheetSelect.value||DEFAULT_SHEET; if(old===DEFAULT_SHEET) return alert('Default cannot be renamed');
    const name=(prompt('New name:', old)||'').trim(); if(!name) return; const names=getSheets(); if(names.includes(name)) return alert('Name exists');
    const idx=names.indexOf(old); names[idx]=name; saveSheets(names);
    localStorage.setItem(keyFor(STORAGE_PREFIX,name), localStorage.getItem(keyFor(STORAGE_PREFIX,old)));
    localStorage.setItem(keyFor(THEME_PREFIX,name), localStorage.getItem(keyFor(THEME_PREFIX,old)));
    localStorage.setItem(keyFor(THEME_PRESET_PREFIX,name), localStorage.getItem(keyFor(THEME_PRESET_PREFIX,old)));
    localStorage.setItem(keyFor(FONT_KEY_PREFIX,name), localStorage.getItem(keyFor(FONT_KEY_PREFIX,old)));
    localStorage.setItem(keyFor(INSTR_PREFIX,name), localStorage.getItem(keyFor(INSTR_PREFIX,old)));
    localStorage.setItem(keyFor(SMS_PREFIX,name), localStorage.getItem(keyFor(SMS_PREFIX,old)));
    localStorage.setItem(keyFor(LINKS_VIS_PREFIX,name), localStorage.getItem(keyFor(LINKS_VIS_PREFIX,old)));
    localStorage.removeItem(keyFor(STORAGE_PREFIX,old)); localStorage.removeItem(keyFor(THEME_PREFIX,old)); localStorage.removeItem(keyFor(THEME_PRESET_PREFIX,old)); localStorage.removeItem(keyFor(FONT_KEY_PREFIX,old)); localStorage.removeItem(keyFor(INSTR_PREFIX,old)); localStorage.removeItem(keyFor(SMS_PREFIX,old)); localStorage.removeItem(keyFor(LINKS_VIS_PREFIX,old));
    refreshSheets(); sheetSelect.value=name; loadState(); loadTheme(); loadLinksVisible();
  });
  document.getElementById('deleteSheetBtn').addEventListener('click', ()=>{
    const name=sheetSelect.value||DEFAULT_SHEET; if(name===DEFAULT_SHEET) return alert('Default cannot be deleted'); if(!confirm('Delete sheet \"'+name+'\"?')) return;
    const names=getSheets().filter(n=>n!==name); saveSheets(names);
    localStorage.removeItem(keyFor(STORAGE_PREFIX,name)); localStorage.removeItem(keyFor(THEME_PREFIX,name)); localStorage.removeItem(keyFor(THEME_PRESET_PREFIX,name)); localStorage.removeItem(keyFor(FONT_KEY_PREFIX,name)); localStorage.removeItem(keyFor(INSTR_PREFIX,name)); localStorage.removeItem(keyFor(SMS_PREFIX,name)); localStorage.removeItem(keyFor(LINKS_VIS_PREFIX,name));
    refreshSheets(); sheetSelect.value=names[0]||DEFAULT_SHEET; loadState(); loadTheme(); loadLinksVisible();
  });

  // Instructions modal
  const instrModal=document.getElementById('instrModal');
  const instrTitle=document.getElementById('instrTitle');
  const instrBody=document.getElementById('instrBody');
  const closeInstrBtn=document.getElementById('closeInstrBtn');
  const editInstrBtn=document.getElementById('editInstrBtn');
  const instrKeyFn=()=> keyFor(INSTR_PREFIX, currentSheet());
  function getInstrMap(){ try{ const raw=localStorage.getItem(instrKeyFn()); return raw?JSON.parse(raw):{}; }catch(e){ return {}; } }
  function saveInstrMap(map){ try{ localStorage.setItem(instrKeyFn(), JSON.stringify(map)); }catch(e){} }
  let currentTaskKey=null;
  function openInstr(titleText){ currentTaskKey=(titleText||'').trim(); const map=getInstrMap(); const txt=map[currentTaskKey] || 'No instructions available yet.'; instrTitle.textContent=currentTaskKey || 'Task Instructions'; instrBody.textContent=txt; instrModal.style.display='flex'; }
  function closeInstr(){ instrModal.style.display='none'; }
  closeInstrBtn.addEventListener('click', closeInstr);
  instrModal.addEventListener('click', (e)=>{ if(e.target===instrModal) closeInstr(); });
  editInstrBtn.addEventListener('click', ()=>{ if(!currentTaskKey) return; const map=getInstrMap(); const prev=map[currentTaskKey]||''; const next=prompt('Instructions for: '+currentTaskKey, prev); if(next===null) return; map[currentTaskKey]=next.trim(); saveInstrMap(map); instrBody.textContent=map[currentTaskKey]||'No instructions available yet.'; });
  document.addEventListener('click', (e)=>{ const lbl=e.target.closest('.label'); if(!lbl) return; const titleText=lbl.textContent||''; if(titleText.trim().length===0) return; openInstr(titleText); });

  // SMS
  function smsKey(){ return keyFor(SMS_PREFIX,currentSheet()); }
  function getSmsRecipients(){ try{ const raw=localStorage.getItem(smsKey()); return raw?JSON.parse(raw):[]; }catch(e){ return []; } }
  function setSmsRecipients(arr){ try{ localStorage.setItem(smsKey(), JSON.stringify(arr)); }catch(e){} }
  function platformIsIOS(){ return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream; }
  function buildSmsUrl(number, body){ const enc=encodeURIComponent(body); if(platformIsIOS()) return 'sms:'+encodeURIComponent(number)+'&body='+enc; return 'sms:'+encodeURIComponent(number)+'?body='+enc; }
  function platformIsIOS(){ return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream; }
function sendTimesheetCompleted(){
  var number = '4356509426';
  var body = 'Timesheet is completed and ready for you.';
  var enc = encodeURIComponent(body);
  var url = platformIsIOS() ? ('sms:' + number + '&body=' + enc) : ('sms:' + number + '?body=' + enc);
  window.location.href = url;
}
function ensureTimesheetSmsButton(){ const ul=document.getElementById('list-biweekly'); if(!ul) return; [...ul.querySelectorAll('li.item')].forEach(li=>{ const lbl=li.querySelector('.label'); if(!lbl) return; const text=(lbl.textContent||'').toLowerCase(); if(text.includes('timesheets')){ if(li.querySelector('.sms-action')) return; const btn=document.createElement('button'); btn.className='btn btn-secondary sms-action'; btn.textContent='Text Timesheet Completed'; btn.style.marginLeft='8px'; btn.addEventListener('click',(e)=>{ e.stopPropagation(); sendTimesheetCompleted(); }); li.appendChild(btn); } }); }
  
  
  
  document.addEventListener('input', (e)=>{ if(e.target && e.target.classList && e.target.classList.contains('label')) ensureTimesheetSmsButton(); });

  // Useful Links visibility (per sheet)
  function linksKey(){ return keyFor(LINKS_VIS_PREFIX,currentSheet()); }
  function setLinksVisible(visible){ const sec=document.getElementById('usefulLinks'); const btn=document.getElementById('toggleLinksBtn'); if(!sec||!btn) return; sec.style.display = visible ? 'block' : 'none'; btn.textContent = visible ? 'Hide Useful Links' : 'Show Useful Links'; try{ localStorage.setItem(linksKey(), JSON.stringify(!!visible)); }catch(e){} }
  function loadLinksVisible(){ let v=false; try{ const raw=localStorage.getItem(linksKey()); if(raw!==null) v = JSON.parse(raw)===true; }catch(e){} setLinksVisible(v); }
  document.getElementById('toggleLinksBtn')?.addEventListener('click', ()=>{ const sec=document.getElementById('usefulLinks'); setLinksVisible(!(sec && sec.style.display!=='none')); });

  // Auto-save (debounced)
  function debounce(fn, ms){ let t; return function(){ clearTimeout(t); t=setTimeout(()=>fn.apply(this, arguments), ms); }; }
  const debouncedSave = debounce(saveState, 250);
  document.getElementById('checklistDate').addEventListener('change', debouncedSave);
  document.addEventListener('change', (e)=>{ if(e.target && e.target.matches('ul.checklist input[type="checkbox"]')) debouncedSave(); });
  document.addEventListener('input', (e)=>{ if(e.target && e.target.classList && e.target.classList.contains('label')) debouncedSave(); });
  document.getElementById('addRowBtn').addEventListener('click', debouncedSave);
  document.addEventListener('click', (e)=>{ if(e.target && e.target.classList && e.target.classList.contains('del')) debouncedSave(); });
  document.addEventListener('dragend', debouncedSave);
  document.addEventListener('visibilitychange', ()=>{ if(document.visibilityState==='hidden') saveState(); });
  window.addEventListener('beforeunload', ()=>{ try{ saveState(); }catch(e){} });

  // Build helpers and init
  function renumberCustom(){ const rows=document.querySelectorAll('#list-custom li.item'); let i=1; rows.forEach(li=>{ let n=li.querySelector('.num'); if(!n){ n=document.createElement('div'); n.className='num'; li.insertBefore(n, li.querySelector('.label')); } n.textContent=(i++)+'.'; }); }
  function applyDefaults(){ 
    const defs={
      'list-1st':[ 'Client Medical Assessment Form','RHS Absentee Form','House Sign-in Sheet','Fire Drill / Natural Disaster Drill','PRN Start Count' ],
      'list-before5th':[ 'Monthly summaries and monthly appointment','Emails to Support Coordinator' ],
      'list-monthly':[ 'House Meeting Notes (Due in Ben office after meeting)','Manager Meeting','Financials' ],
      'list-biweekly':[ 'Timesheets / Absentee Sheet','Check in Times for Accuracy' ],
      'list-daily':[ 'Check MARs and notes of your staff' ],
      'list-custom':[ 'Custom item 1','Custom item 2','Custom item 3' ]
    };
    ['list-1st','list-before5th','list-monthly','list-biweekly','list-daily','list-custom'].forEach(id=>{
      const ul=document.getElementById(id); ul.innerHTML=''; defs[id].forEach(lbl=>{ ul.appendChild(mkItem(lbl, id==='list-custom')); });
    });
    renumberCustom();
  }
  function mkItem(label, withNumber){
    const li=document.createElement('li'); li.className='item'; li.setAttribute('draggable','true');
    li.innerHTML = withNumber ? '<input type="checkbox"><div class="num"></div><div class="label" contenteditable="true"></div><button class="del" title="Remove">Ã—</button>'
                              : '<input type="checkbox"><div class="label"></div><button class="del" title="Remove">Ã—</button>';
    li.querySelector('.label').textContent = label || '';
    return li;
  }

  function init(){
    ensureDefault(); refreshSheets(); loadTheme();
    try{ const raw=localStorage.getItem(keyFor(STORAGE_PREFIX,currentSheet())); if(raw) applyState(JSON.parse(raw)); else { applyDefaults(); saveState(); } }catch(e){ applyDefaults(); saveState(); }
    loadPresetOptions(); loadFontOptions(); loadLinksVisible(); ensureTimesheetSmsButton();
    setTimeout(()=>{ try{ saveState(); }catch(e){} }, 300);
  }
  init();
});
</script>


<script>
(function(){
  var WaterAudio=(function(){
    var ctx=null;
    function ensure(){
      if(ctx) return ctx;
      var AC=window.AudioContext||window.webkitAudioContext;
      if(!AC) return null;
      ctx=new AC();
      return ctx;
    }
    function plink(){
      var c=ensure(); if(!c) return;
      try{ if(c.state==='suspended'){ c.resume(); } }catch(e){}
      var t=c.currentTime;
      var master=c.createGain(); master.gain.value=0.12; master.connect(c.destination);
      // Short noise click
      var nlen=0.04*c.sampleRate; var nb=c.createBuffer(1,nlen,c.sampleRate); var d=nb.getChannelData(0);
      for(var i=0;i<nlen;i++){ d[i]=(Math.random()*2-1)*(1-i/nlen); }
      var noise=c.createBufferSource(); noise.buffer=nb;
      var hp=c.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=900; hp.Q.value=0.7;
      var ng=c.createGain(); ng.gain.setValueAtTime(0.0,t); ng.gain.linearRampToValueAtTime(0.2,t+0.005); ng.gain.exponentialRampToValueAtTime(0.001,t+0.05);
      noise.connect(hp); hp.connect(ng); ng.connect(master); noise.start(t); noise.stop(t+0.06);
      // Cartoon sine "plink" with quick downward glide
      var osc=c.createOscillator(); osc.type='sine';
      var og=c.createGain(); og.gain.setValueAtTime(0.0,t); og.gain.linearRampToValueAtTime(0.5,t+0.008); og.gain.exponentialRampToValueAtTime(0.001,t+0.09);
      osc.frequency.setValueAtTime(1800,t);
      osc.frequency.exponentialRampToValueAtTime(1000,t+0.08);
      osc.connect(og); og.connect(master);
      osc.start(t); osc.stop(t+0.1);
      // Soft resonant ping
      var res=c.createBiquadFilter(); res.type='bandpass'; res.frequency.value=1400; res.Q.value=6;
      master.disconnect(); master.connect(res); res.connect(c.destination);
    }
    return { play: plink };
  })();

  function onChangePlink(e){
    e=e||window.event;
    var t=e.target||e.srcElement;
    if(!t) return;
    if(t.tagName==='INPUT' && t.type==='checkbox'){
      if(t.checked){ try{ WaterAudio.play(); }catch(_e){} }
    }
  }
  // replace previous listener if any by adding a capturing listener (safe duplicate)
  document.addEventListener('change', onChangePlink, true);
})();
</script>


<!-- Appt's Modal -->

  </div>
</div>


<script>
// --- Robust match helper: finds the label element for "Client Medical Assessment/Assesment Form"
function findClientMedicalLabel(){
  var candidates = document.querySelectorAll(
    '#list-monthly li, li.item, .label, li span, li'
  );
  for (var i=0; i<candidates.length; i++){
    var el = candidates[i];
    var text = (el.textContent || '').replace(/\s+/g,' ').trim().toLowerCase();
    if (!text) continue;
    // tolerate "assessment" vs "assesment" and ordering noise
    if (/(client).*(medical).*(asses?ment).*(form)/.test(text)) {
      // prefer a dedicated .label span if present
      if (el.classList && el.classList.contains('label')) return el;
      var label = el.querySelector('.label');
      return label || el;
    }
  }
  return null;
}

// --- Replace your previous ensureApptsButton with this:
function ensureApptsButton(){
  var label = findClientMedicalLabel();
  if(!label) return;
  // don't duplicate
  var parentLi = label.closest('li') || label.parentNode;
  if (parentLi && parentLi.querySelector('.appt2-action')) return;

  var btn = document.createElement('button');
  btn.type = 'button';
  btn.className = 'appt2-action';
  btn.textContent = "Appt's";
  btn.addEventListener('click', function(e){
    e.stopPropagation();
    // openModal is from the Appt's module you added
    if (typeof openModal === 'function') openModal();
  });

  // place directly after the label
  label.insertAdjacentElement('afterend', btn);
}

// --- Run once after DOM ready
document.addEventListener('DOMContentLoaded', function(){
  ensureApptsButton();
});

// --- Also re-run when the DOM updates (useful if the list is rendered later)
var mo = new MutationObserver(function(){
  ensureApptsButton();
});
mo.observe(document.body, { childList: true, subtree: true });

// --- If your sheet select changes the list, keep the button present per-sheet
document.addEventListener('change', function(e){
  var t = e.target || e.srcElement;
  if (t && t.id === 'sheetSelect'){
    setTimeout(ensureApptsButton, 0);
  }
}, true);
</script>



<script>
// ==== Monthly Appointment Tracker (inline section) ====
(function(){
  function $(s, r){ return (r||document).querySelector(s); }
  function $$(s, r){ return Array.prototype.slice.call((r||document).querySelectorAll(s)); }
  function currentSheet(){ var s=document.getElementById('sheetSelect'); return (s && s.value) ? s.value : 'Default'; }

  var KEY_PREFIX = 'nes.v36.apptTracker|';
  function storeKey(){ return KEY_PREFIX + currentSheet(); }
  function loadData(){
    try{
      var raw = localStorage.getItem(storeKey());
      var o = raw ? JSON.parse(raw) : null;
      if (!o || typeof o !== 'object') o = { clients:[], appts:{} };
      if (!o.clients) o.clients = [];
      if (!o.appts) o.appts = {};
      return o;
    }catch(e){ return { clients:[], appts:{} }; }
  }
  function saveData(o){
    try{ localStorage.setItem(storeKey(), JSON.stringify(o||{clients:[], appts:{}})); }catch(e){}
  }

  function createSection(){
    var wrap = document.createElement('section');
    wrap.id = 'apptTracker';
    wrap.className = 'card';
    wrap.innerHTML = [
      '<header>',
      '  <h2>Monthly Appointment Tracker</h2>',
      '</header>',
      '<div class="body">',
      '  <div class="col">',
      '    <div class="subhead">Clients</div>',
      '    <ul class="list" id="apTr_clients"></ul>',
      '    <div class="inputs" style="margin-top:8px;">',
      '      <input id="apTr_newClient" type="text" placeholder="New client name" style="flex:1 1 auto;">',
      '      <button class="btn primary" id="apTr_addClient">Add Client</button>',
      '    </div>',
      '  </div>',
      '  <div class="col">',
      '    <div class="subhead">Appointments for <span id="apTr_current" style="font-weight:800;">(none)</span></div>',
      '    <ul class="list" id="apTr_appts"></ul>',
      '    <div class="inputs">',
      '      <input id="apTr_date" type="date" style="max-width:160px;">',
      '      <input id="apTr_time" type="time" style="max-width:140px;">',
      '      <input id="apTr_doctor" type="text" placeholder="Doctor name" style="flex:1 1 200px;">',
      '      <button class="btn primary" id="apTr_addAppt">Add Appt</button>',
      '    </div>',
      '  </div>',
      '</div>'
    ].join('');
    return wrap;
  }

  function insertAboveUsefulLinks(sec){
    var main = document.querySelector('main') || document.body;
    var target = document.getElementById('useful-links');
    if (!target){
      var heads = $$('.section-title, h2, h3, header', main);
      for (var i=0;i<heads.length;i++){
        var t = (heads[i].textContent||'').trim().toLowerCase();
        if (t.indexOf('useful links') !== -1) { target = heads[i].closest('section') || heads[i].parentElement; break; }
      }
    }
    if (target && target.parentNode){
      target.parentNode.insertBefore(sec, target);
    } else {
      main.appendChild(sec);
    }
  }

  var selectedClient = null;

  function renderClients(){
    var box = $('#apTr_clients'); if(!box) return;
    box.innerHTML = '';
    var d = loadData();
    if (!d.clients.length){
      var li = document.createElement('li');
      li.className = 'row';
      li.textContent = 'No clients yet.';
      li.style.color = '#555';
      box.appendChild(li);
      $('#apTr_current').textContent = '(none)';
      var apList = $('#apTr_appts'); if(apList) apList.innerHTML = '';
      return;
    }
    d.clients.forEach(function(name){
      var li = document.createElement('li'); li.className = 'row';
      var line = document.createElement('div'); line.className = 'line';
      var left = document.createElement('div'); left.style.fontWeight='700'; left.textContent = name;
      var right = document.createElement('div');
      var open = document.createElement('button'); open.className='btn'; open.textContent='Open';
      open.onclick = function(){ selectClient(name); };
      var del = document.createElement('button'); del.className='btn'; del.textContent='Delete';
      del.onclick = function(){
        var x = loadData();
        var idx = x.clients.indexOf(name);
        if (idx >= 0) x.clients.splice(idx,1);
        delete x.appts[name];
        saveData(x);
        if (selectedClient === name) selectedClient = null;
        renderClients();
      };
      right.appendChild(open); right.appendChild(del);
      line.appendChild(left); line.appendChild(right);
      li.appendChild(line);
      box.appendChild(li);
    });
  }

  function selectClient(name){
    var d = loadData();
    if (!name || d.clients.indexOf(name) === -1){
      name = d.clients.length ? d.clients[0] : null;
    }
    selectedClient = name;
    var cur = document.getElementById('apTr_current'); if(cur) cur.textContent = selectedClient || '(none)';
    renderAppts();
  }

  function renderAppts(){
    var ul = document.getElementById('apTr_appts'); if(!ul) return;
    ul.innerHTML = '';
    if (!selectedClient) return;
    var d = loadData();
    var list = d.appts[selectedClient] || [];
    if (!list.length){
      var li = document.createElement('li'); li.className='row'; li.textContent='No appointments yet.'; li.style.color='#555';
      ul.appendChild(li); return;
    }
    list.forEach(function(a,idx){
      var li = document.createElement('li'); li.className = 'row';
      var line = document.createElement('div'); line.className='line';
      var left = document.createElement('div');
      left.innerHTML = '<strong>' + (a.date||'') + '</strong> ' + (a.time||'') + (a.doctor ? (' â€” ' + a.doctor) : '');
      var right = document.createElement('div');
      var del = document.createElement('button'); del.className='btn'; del.textContent='Delete';
      del.onclick = function(){
        var x = loadData();
        if (!x.appts[selectedClient]) x.appts[selectedClient] = [];
        x.appts[selectedClient].splice(idx,1);
        saveData(x);
        renderAppts();
      };
      right.appendChild(del);
      line.appendChild(left); line.appendChild(right);
      li.appendChild(line);
      ul.appendChild(li);
    });
  }

  function addClient(){
    var inp = document.getElementById('apTr_newClient');
    var name = (inp && inp.value || '').trim();
    if (!name){ alert('Enter a client name'); return; }
    var d = loadData();
    if (d.clients.indexOf(name) !== -1){ alert('Client already exists'); return; }
    d.clients.push(name);
    if (!d.appts[name]) d.appts[name] = [];
    saveData(d);
    inp.value = '';
    selectedClient = name;
    renderClients();
    selectClient(name);
  }

  function addAppt(){
    if (!selectedClient){ alert('Pick a client first'); return; }
    var dt = document.getElementById('apTr_date');
    var tm = document.getElementById('apTr_time');
    var dr = document.getElementById('apTr_doctor');
    var date = dt && dt.value ? dt.value : '';
    var time = tm && tm.value ? tm.value : '';
    var doc  = dr && dr.value ? dr.value.trim() : '';
    if (!date){ alert('Pick a date'); return; }
    var d = loadData();
    if (!d.appts[selectedClient]) d.appts[selectedClient] = [];
    d.appts[selectedClient].push({date:date, time:time, doctor:doc});
    saveData(d);
    if (dt) dt.value=''; if (tm) tm.value=''; if (dr) dr.value='';
    renderAppts();
  }

  document.addEventListener('DOMContentLoaded', function(){
    var sec = createSection();
    var main = document.querySelector('main') || document.body;
    // place before Useful Links (if present)
    (function insertAboveUsefulLinks(){
      var target = document.getElementById('useful-links');
      if (!target){
        var heads = $$('.section-title, h2, h3, header', main);
        for (var i=0;i<heads.length;i++){
          var t = (heads[i].textContent||'').trim().toLowerCase();
          if (t.indexOf('useful links') !== -1) { target = heads[i].closest('section') || heads[i].parentElement; break; }
        }
      }
      if (target && target.parentNode){
        target.parentNode.insertBefore(sec, target);
      } else {
        main.appendChild(sec);
      }
    })();

    // wire actions + first render
    var addC = document.getElementById('apTr_addClient'); if (addC) addC.addEventListener('click', addClient);
    var addA = document.getElementById('apTr_addAppt'); if (addA) addA.addEventListener('click', addAppt);
    renderClients();
    selectClient(null);
  });

  document.addEventListener('change', function(e){
    var t = e.target || e.srcElement;
    if (t && t.id === 'sheetSelect'){
      renderClients();
      selectClient(null);
    }
  }, true);
})();
</script>

<!-- Manager Documents Modal -->
<div id="mgrDocsModal" role="dialog" aria-modal="true" aria-label="Manager Documents">
  <div class="dlg">
    <header>
      <h3>Manager Documents</h3>
      <div><button id="mgrDocsClose" class="mgr-btn">Close</button></div>
    </header>
    <div class="body">
      <div class="mgr-add">
        <strong>Add Document (optional, device-only)</strong>
        <input id="mgrDocTitle" type="text" placeholder="Document title">
        <input id="mgrDocFile" type="file" accept="application/pdf">
        <button id="mgrDocAddBtn" class="mgr-btn">Add</button>
      </div>
      <div id="mgrDocsList"></div>
    </div>
  </div>
</div>




<script id="day-service-events-js">
(function(){
  // ---- Helpers ----
  function $(s, r){ return (r||document).querySelector(s); }
  function $$(s, r){ return Array.prototype.slice.call((r||document).querySelectorAll(s)); }
  function currentSheet(){ var s=$('#sheetSelect'); return (s&&s.value)?s.value:'Default'; }

  var KEY_PREFIX='nes.v36.dayServiceEvents|';
  function key(){ return KEY_PREFIX + currentSheet(); }

  function load(){
    try{ return JSON.parse(localStorage.getItem(key())||'[]'); }catch(e){ return []; }
  }
  function save(arr){
    try{ localStorage.setItem(key(), JSON.stringify(arr||[])); }catch(e){}
    // ping autosave listeners if any
    window.dispatchEvent(new Event('nes:autosave:ping'));
  }

  // ---- Section DOM ----
  function createSection(){
    var sec=document.createElement('section');
    sec.id='dayServiceEvents';
    sec.className='card';
    sec.innerHTML=[
      '<header><h2>Day Service Events</h2></header>',
      '<div class="body">',
      '  <div class="col">',
      '    <div class="subhead">Add Event</div>',
      '    <div class="inputs">',
      '      <input id="dse_date" type="date" style="max-width:160px;">',
      '      <input id="dse_time" type="time" style="max-width:140px;">',
      '      <input id="dse_items" type="text" placeholder="Required items (e.g., ID, lunch, meds)" style="flex:1 1 220px;">',
      '      <button id="dse_add" class="btn primary">Add</button>',
      '    </div>',
      '  </div>',
      '  <div class="col">',
      '    <div class="subhead">Upcoming / Logged</div>',
      '    <ul id="dse_list" class="list"></ul>',
      '  </div>',
      '</div>'
    ].join('');
    return sec;
  }

  function insertBelowMedicalAppointments(sec){
    // Try to place directly below the medical appointments tracker if present
    var appt = document.getElementById('apptTracker');
    if(appt && appt.parentNode){
      appt.parentNode.insertBefore(sec, appt.nextSibling);
      return;
    }
    // Fallback: insert above Useful Links
    var main=document.querySelector('main')||document.body;
    var target=document.getElementById('useful-links');
    if(!target){
      var heads=$$('.section-title,h2,h3,header', main);
      for(var i=0;i<heads.length;i++){
        var t=(heads[i].textContent||'').trim().toLowerCase();
        if(t.indexOf('useful links')!==-1){ target=heads[i].closest('section')||heads[i].parentElement; break; }
      }
    }
    if(target && target.parentNode){ target.parentNode.insertBefore(sec, target); }
    else { main.appendChild(sec); }
  }

  // ---- Render ----
  function render(){
    var ul=$('#dse_list'); if(!ul) return;
    ul.innerHTML='';
    var data=load();
    if(!data.length){
      var li=document.createElement('li'); li.className='row';
      li.textContent='No events yet.';
      li.style.color='#555';
      ul.appendChild(li);
      return;
    }
    data.forEach(function(ev, idx){
      var li=document.createElement('li'); li.className='row';
      var left=document.createElement('div'); left.className='line';
      var date=ev.date||'', time=ev.time||'', items=ev.items||'';
      left.innerHTML='<strong>'+date+'</strong>' + (time?(' '+time):'') + (items?(' â€” '+items):'');
      var right=document.createElement('div');
      var del=document.createElement('button'); del.className='btn'; del.textContent='Delete';
      del.onclick=function(){
        var arr=load(); arr.splice(idx,1); save(arr); render();
      };
      right.appendChild(del);
      li.appendChild(left); li.appendChild(right);
      ul.appendChild(li);
    });
  }

  // ---- Actions ----
  function addEvent(){
    var dt=$('#dse_date'), tm=$('#dse_time'), it=$('#dse_items');
    var date=dt && dt.value ? dt.value : '';
    var time=tm && tm.value ? tm.value : '';
    var items=it && it.value ? it.value.trim() : '';
    if(!date){ alert('Please select a date'); return; }
    var arr=load(); arr.push({date:date, time:time, items:items});
    save(arr);
    if(dt) dt.value=''; if(tm) tm.value=''; if(it) it.value='';
    render();
  }

  // ---- Mount ----
  document.addEventListener('DOMContentLoaded', function(){
    var sec=createSection();
    insertBelowMedicalAppointments(sec);
    $('#dse_add') && $('#dse_add').addEventListener('click', addEvent);
    render();
  });

  // Re-render on sheet change
  document.addEventListener('change', function(e){
    var t=e.target||e.srcElement;
    if(t && t.id==='sheetSelect'){ render(); }
  }, true);

})();
</script>


<script id="mgrdocs-js">
(function(){
  const MANAGER_DOCS=[
    {title:"Sign-in Sheet",src:"assets/manager-docs/sign-in-sheet.pdf"},
    {title:"House Meeting Notes",src:"assets/manager-docs/house-meeting-notes.pdf"},
    {title:"Monthly Medical Report",src:"assets/manager-docs/monthly-medical-report.pdf"},
    {title:"RHS Absentee Form",src:"assets/manager-docs/rhs-absentee-form.pdf"}
  ];
  const $=(s,r)=>(r||document).querySelector(s);
  const norm=t=>(t||"").replace(/\s+/g," ").trim().toLowerCase();

  const DB='nesMgrDocsDB', STORE='mgrDocs';
  function openDB(){return new Promise((res,rej)=>{const r=indexedDB.open(DB,1);
    r.onupgradeneeded=e=>{const db=e.target.result;if(!db.objectStoreNames.contains(STORE)){db.createObjectStore(STORE,{keyPath:'id'}).createIndex('byTitle','title',{unique:false});}};
    r.onsuccess=e=>res(e.target.result); r.onerror=e=>rej(e.target.error);
  });}
  function idbList(){return openDB().then(db=>new Promise((res,rej)=>{
    const tx=db.transaction(STORE,'readonly'), st=tx.objectStore(STORE);
    const out=[], cur=st.openCursor(); cur.onsuccess=e=>{const c=e.target.result;
      if(c){ out.push(c.value); c.continue(); } else res(out);
    }; cur.onerror=e=>rej(e.target.error);
  }));}
  function idbGet(id){return openDB().then(db=>new Promise((res,rej)=>{
    const tx=db.transaction(STORE,'readonly'), st=tx.objectStore(STORE);
    const r=st.get(id); r.onsuccess=e=>res(e.target.result||null); r.onerror=e=>rej(e.target.error);
  }));}
  function idbAdd(title,file){return openDB().then(db=>new Promise((res,rej)=>{
    const tx=db.transaction(STORE,'readwrite'), st=tx.objectStore(STORE);
    const rec={id:'doc:'+Date.now()+'-'+Math.random().toString(36).slice(2),title:title||file.name,
      name:file.name,size:file.size||0,type:file.type||'application/pdf',created:new Date().toISOString(),blob:file};
    st.put(rec); tx.oncomplete=()=>res(rec); tx.onerror=e=>rej(e.target.error);
  }));}
  function idbDelete(id){return openDB().then(db=>new Promise((res,rej)=>{
    const tx=db.transaction(STORE,'readwrite'), st=tx.objectStore(STORE);
    st.delete(id); tx.oncomplete=()=>res(); tx.onerror=e=>rej(e.target.error);
  }));}

  const modal=$('#mgrDocsModal'), list=$('#mgrDocsList');
  const addBtn=$('#mgrDocAddBtn'), fileInp=$('#mgrDocFile'), titleInp=$('#mgrDocTitle');
  const search=$('#mgrDocsSearch'), clearBtn=$('#mgrDocsClear');
  const iframe=$('#mgrPreview'), printBtn=$('#mgrPreviewPrint'), openBtn=$('#mgrPreviewOpen'),
        hint=$('#mgrPreviewHint'), fallback=$('#mgrPreviewFallback');

  let current=null; // {title, url, revoke?}

  async function toBlobUrlFromPath(path){
    const res=await fetch(path,{cache:'no-store'});
    const blob=await res.blob();
    const url=URL.createObjectURL(blob);
    return {url, revoke:()=>URL.revokeObjectURL(url)};
  }

  async function setPreview(rec){
    if(current && current.revoke){ try{ current.revoke(); }catch(e){} }
    current=null; iframe.removeAttribute('src'); fallback.style.display='none';
    if(!rec){ hint.textContent='Select a document to preview'; return; }
    hint.textContent='';
    try{
      if(rec.type==='static'){
        const b=await toBlobUrlFromPath(rec.src);
        current={title:rec.title,url:b.url,revoke:b.revoke};
      }else if(rec.type==='local'){
        const row=await idbGet(rec.id);
        if(!row||!row.blob) throw new Error('Missing local file');
        const url=URL.createObjectURL(row.blob);
        current={title:row.title||row.name,url, revoke:()=>URL.revokeObjectURL(url)};
      }else{ throw new Error('Bad rec'); }
      iframe.src=current.url;
      let loaded=false; iframe.onload=()=>{ loaded=true; };
      setTimeout(()=>{ if(!loaded){ fallback.style.display='flex'; } }, 800);
    }catch(e){ fallback.style.display='flex'; }
  }

  function printNow(){
    if(!current){ alert('Select a document first.'); return; }
    // Prefer printing the already loaded preview iframe (keeps user gesture)
    try{
      const w = iframe && iframe.contentWindow;
      if(w){ w.focus(); w.print(); return; }
    }catch(e){ /* continue */ }
    // Fallback to transient iframe (no popup)
    try{
      const fr=document.createElement('iframe');
      fr.style.position='fixed'; fr.style.right='0'; fr.style.bottom='0';
      fr.style.width='0'; fr.style.height='0'; fr.style.border='0';
      fr.src=current.url;
      let cleaned=false; function cleanup(){ if(cleaned) return; cleaned=true; setTimeout(()=>{ try{ document.body.removeChild(fr); }catch(e){} }, 200); }
      fr.onload=function(){ try{ const w=fr.contentWindow; if(!w) throw 0; w.focus(); w.print(); cleanup(); } catch(e){ cleanup(); alert('Printing is blocked by this browser. Open in a new tab and print.'); } };
      document.body.appendChild(fr);
      return;
    }catch(e){}
    alert('Printing is blocked by this browser. Open in a new tab and print.');
  }

  function mkBtn(t,fn){ const b=document.createElement('button'); b.className='mgr-btn'; b.textContent=t; b.onclick=fn; return b; }
  function rowStatic(title,src){
    const r=document.createElement('div'); r.className='mgr-row';
    const left=document.createElement('div'); left.className='mgr-left';
    const ic=document.createElement('div'); ic.className='icon'; ic.textContent='ðŸ“„';
    const name=document.createElement('div'); name.className='mgr-title'; name.textContent=title||src;
    left.appendChild(ic); left.appendChild(name);
    const actions=document.createElement('div'); actions.className='mgr-actions';
    const view=mkBtn('Preview', ()=> setPreview({type:'static', title, src}));
    const prn=mkBtn('Print', ()=>{ printNow(); }); prn.classList.add('primary');
    actions.appendChild(view); actions.appendChild(prn);
    r.appendChild(left); r.appendChild(actions); return r;
  }
  function rowLocal(rec){
    const r=document.createElement('div'); r.className='mgr-row';
    const left=document.createElement('div'); left.className='mgr-left';
    const ic=document.createElement('div'); ic.className='icon'; ic.textContent='ðŸ“„';
    const name=document.createElement('div'); name.className='mgr-title'; name.textContent=rec.title||rec.name||'Document';
    left.appendChild(ic); left.appendChild(name);
    const actions=document.createElement('div'); actions.className='mgr-actions';
    const view=mkBtn('Preview', ()=> setPreview({type:'local', id:rec.id}));
    const prn=mkBtn('Print', ()=>{ printNow(); }); prn.classList.add('primary');
    const del=mkBtn('Delete', ()=>{ if(confirm('Delete this local document?')) idbDelete(rec.id).then(renderList); });
    actions.appendChild(view); actions.appendChild(prn); actions.appendChild(del);
    r.appendChild(left); r.appendChild(actions); return r;
  }

  async function renderList(){
    list.innerHTML='';
    const q=norm(search?.value);
    MANAGER_DOCS.filter(d=>!q||norm(d.title).includes(q)).forEach(d=> list.appendChild(rowStatic(d.title,d.src)));
    const rows=await idbList();
    rows.sort((a,b)=>(a.title||'').localeCompare(b.title||''));
    rows.filter(r=>!q||norm(r.title).includes(q)).forEach(r=> list.appendChild(rowLocal(r)));
  }

  function openModal(){ renderList(); setPreview(null); modal.style.display='flex'; }
  function closeModal(){ setPreview(null); modal.style.display='none'; }
  $('#mgrDocsClose')?.addEventListener('click', closeModal);
  modal?.addEventListener('click', e=>{ if(e.target===modal) closeModal(); });

  $('#mgrPreviewPrint')?.addEventListener('click', printNow);
  $('#mgrPreviewOpen')?.addEventListener('click', ()=>{
    if(!current){ alert('Select a document first.'); return; }
    const w=window.open(current.url,'_blank','noopener,noreferrer'); if(!w) alert('Your browser blocked opening a tab. Enable popups for this site.');
  });

  addBtn?.addEventListener('click', ()=>{
    const file=fileInp?.files&&fileInp.files[0];
    if(!file){ alert('Choose a PDF'); return; }
    if(file.type!=='application/pdf'){ alert('Please select a PDF file.'); return; }
    const title=(titleInp?.value||'').trim()||file.name.replace(/\.[^.]+$/,'');
    idbAdd(title,file).then(()=>{ if(titleInp) titleInp.value=''; if(fileInp) fileInp.value=''; renderList(); })
      .catch(()=> alert('Could not save document on this device.'));
  });
  search?.addEventListener('input', renderList);
  clearBtn?.addEventListener('click', ()=>{ if(search){ search.value=''; renderList(); } });

  function ensureManagerDocsButton(){
    const container=document.getElementById('useful-links')||document.querySelector('#topbar, header, .toolbar')||document.body;
    if(!container) return;
    if(container.querySelector('[data-role="mgr-docs-open"]')) return;
    const host=container.querySelector('.link-grid')||container;
    const btn=document.createElement('button');
    btn.type='button'; btn.dataset.role='mgr-docs-open'; btn.textContent='Manager Documents';
    btn.className=host.classList.contains('link-grid')?'ulx-btn':'btn btn-primary';
    btn.style.margin='4px 0'; btn.addEventListener('click', openModal);
    host.appendChild(btn);
  }
  document.addEventListener('DOMContentLoaded', ensureManagerDocsButton);
})();
</script>

</body>
</html>
